{% load static %}
<html>
<head>
    <title>Officer Dashboard</title>
    <meta name="viewport" content="height=device-height, initial-scale=1">

    <!-- CSS LINKS -->
    <link rel="stylesheet" type="text/css" href="{% static 'officer/css/components/officer.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'officer/css/components/officer-results.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'sysadmin/css/components/admin.css' %}"/>
    <link href="{% static 'sysadmin/css/components/election-controls.css' %}" rel="stylesheet" type="text/css" />

    <script src="{% static 'officer/js/Chart.min.js' %}"></script>
    <script src="{% static 'sysadmin/js/elections.js' %}"></script>
    <script src="{% static 'sysadmin/js/election_modal.js' %}" type="text/javascript"></script>

</head>
<body {% if identifier %}onload="drawChart('{{ vote_results_json|escapejs }}')" {% endif %}>
<!-- HEADER BAR THING -->
<div id="header-container">
    <img id="header-ballot" src="{% static 'sysadmin/assets/svg/ballot-white.svg' %}">
    <a href="{% url 'sysadmin:elections' %}" id="selected">Election Status</a>
    <a href="{% url 'sysadmin:voters' %}">Voters List</a>
    <a href="{% url 'sysadmin:candidates' %}">Candidates List</a>
    <a href="{% url 'sysadmin:officers' %}">Comelec Officers</a>
    <a href="{% url 'sysadmin:units' %}">Units</a>
    <a href="{% url 'sysadmin:positions' %}">Positions</a>
    <a href="{% url 'sysadmin:issues' %}">Issues</a>
    <a href="{% url 'sysadmin:polls' %}">Polls</a>
    <div id="user-container">
        <img id="user-icon" src="{% static 'sysadmin/assets/svg/user.svg' %}">
        <div id="user-name"> {{ user.first_name }} {{ user.last_name }}</div>
        <a id="log-out" href="{% url 'logout:logout' %}">Logout</a>
    </div>
</div>

<!-- TABS BUTTONS TO TRAVERSE THE DIFF SECTIONS -->
<div id="tab-buttons-container">
    <button class="tab-buttons {% if not open_audit %}active{% endif %}" onclick="openTab(event, 'Controls')" id="tab-controls">Election Control</button>
    <!-- <button class="tab-buttons" onclick="openTab(event, 'Unblock')" id="tab-archive">Unblock Results</button>
    <button class="tab-buttons" onclick="openTab(event, 'Archive')" id="tab-archive">Archive all results</button> -->
    <button class="tab-buttons {% if open_audit %}active{% endif %}" onclick="openTab(event, 'Audit')" id="tab-archive">Check Audits</button>
</div>

<!-- CONTAINER WHERE TABS WILL OCCUPY -->
<div id="tab-container">
    <div style="margin-top: 100px;">
    </div>
    {% if messages %}
        <div>
            {% for message in messages %}
                <p {% if message.tags %}id="{{ message.tags }}"{% endif %}>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <div id="Controls" class="tab-content" style="{% if open_audit %}display: none{% endif %}">
        <div class="controls-container">
            <form action="" method="POST">
                {% csrf_token %}
                <input type="hidden" name="form-type" id="election-form-type"
                        value="{% if not election_state or election_state == 'archived' %}start-elections{% elif election_state == 'ongoing' or election_state == 'paused' %}end-elections{% endif %}">

                {% if election_state != 'finished' and election_state != 'blocked' %}
                    <div class="controls-header">
                        Colleges
                        {% if not election_state or election_state == 'archived' %}
                            <input type="button" class="smallbutton" onclick="selectAll()"
                                value="Select All">
                        {% endif %}
                    </div>
                    </br>
                    {% for college in colleges %}
                        <div class="controls-header">
                            {{ college.name }}
                            {% if not election_state or election_state == 'archived' %}
                                <input type="button" class="smallbutton" onclick="selectAllCollege('{{ college.name }}-batch')"
                                    value="Select {{ college.name }}">
                            {% endif %}
                        </div>
                        <div class="controls">
                            {% if not election_state or election_state == 'archived'%}
                                {% for batch in batches %}
                                    <li class="batch-checkboxes">
                                        <input id="{{ college.name }}-{{ batch }}" name="{{ college.name }}-batch"
                                                type="checkbox" value="{{ batch }}">
                                        <label for="{{ college.name }}-{{ batch }}">{{ batch }}</label>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <b>Batches eligible for this college:</b>
                                {% for college_key, batch_val in college_batch_dict.items %}
                                    {% if college_key == college.name %}
                                        {% for batch in batch_val %}
                                            <li class="batch-checkboxes">
                                                {{ batch }}{% if not forloop.last %},{% endif %}</li>
                                        {% endfor %}
                                    {% else %}
                                        {% if college.name not in college_batch_dict.keys and forloop.last %}
                                            <li class="batch-checkboxes">None.</li>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
                <div class="controls-instruction">
                        <b>Reenter your password</b>, then click the <b>open 
                        controls </b> button to see your options.
                </div>
                <div class="controls">
                    <label class="info-label" for="reauth">Reenter your password</label>
                    <br>
                    <input id="reauth" class="password-reauth" type="password" name="reauth" required="required">
                    <br>
                    <div id="election-controls">
                        {% if election_state == "finished" %}
                            <button type="button" id="archive" class="control-confirm" onclick="setState('archive')">Archive Elections</button>
                        {% endif %}
                        {% if election_state == "blocked" %}
                            <button type="button" id="unblock" class="control-confirm" onclick="setState('unblock')">Unblock Elections</button>
                        {% endif %}
                        {% if election_state == "ongoing" or election_state == "paused" %}
                            <button type="button" id="end" class="control-cancel" onclick="setState('end')">End Elections</button>
                        {% endif %}
                        {% if election_state == "paused" %}
                            <button type="button" id="resume" class="control-confirm" onclick="setState('resume')">Resume Elections</button>
                        {% endif %}
                        {% if election_state == "ongoing" %}
                            <button type="button" id="pause" class="control-confirm" onclick="setState('pause')">Pause Elections</button>
                        {% endif %}
                        {% if not election_state or election_state == "archived" %}
                            <button type="button" id="start" class="control-confirm" onclick="setState('start')">Start Elections</button>
                        {% endif %}
                    </div>
                </div>
                <div id="election-modal">
                    <div id="modal-controls">
                        <div class="controls-header">Confirm Action</div>
                        <div id="controls-confirm" class="clearfix">
                            <button type="button" id="close" class="control-cancel" onclick="closeModal(event)">Cancel</button>
                            <input type="submit" id="submit" class="control-confirm" value="Confirm"/>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div id="logo">
            <img width=500 height=50 src="{% static 'officer/assets/svg/org-logos.svg' %}">
        </div>
    </div>

    <!-- <div id="Archive" class="tab-content" style="display: none">
        {% if election_state != 'finished' %}
            <img id="stop" src="{% static 'passcode/assets/svg/stop.svg' %}">
            <header>Woah there!</header>
            <div class="prohibited">
                You may not archive any results until the elections are done.
            </div>
        {% else %}
            <form method="POST" action="">
                {% csrf_token %}
                <input type="hidden" name="form-type" value="archive-results">
                <div class="controls-instruction">
                    Once you're done viewing the election results, reenter your password and click the
                    <b>archive button</b> to <b>archive</b> <i>all</i> the results to a CSV file. Archiving the
                    results
                    will also clear <i>all</i> votes, voters, candidates, batch positions, batch units, issues, and polls from
                    this website.
                </div>
                <div class="controls">
                    <label class="info-label" for="reauth-archive">Reenter your password</label>
                    <br>
                    <input id="reauth-archive" class="password-reauth" type="password" name="reauth-archive"
                           required="required">
                    <br>
                    <input class="button confirm"
                           type="submit" value="Archive election results">
                </div>
            </form>
        {% endif %}

        <div id="logo">
            <img width=500 height=50 src="{% static 'passcode/assets/svg/org-logos.svg' %}">
        </div>
    </div>

    <div id="Unblock" class="tab-content" style="display: none">
        {% if election_state != 'blocked' %}
            <img id="stop" src="{% static 'passcode/assets/svg/stop.svg' %}">
            <header>Woah there!</header>
            <div class="prohibited">
                The elections have not ended yet.
            </div>
        {% else %}
            <form method="POST" action="">
                {% csrf_token %}
                <input type="hidden" name="form-type" value="unblock-results">
                <div class="controls-instruction">
                    Once you're ready to view the election results, reenter your password and click the
                    <b>Unblock button</b> to <b>unblock</b> the election results.

                    This <b>cannot</b> be undone!
                </div>
                <div class="controls">
                    <label class="info-label" for="reauth-unblock">Reenter your password</label>
                    <br>
                    <input id="reauth-unblock" class="password-reauth" type="password" name="reauth-unblock"
                           required="required">
                    <br>
                    <input class="button confirm" type="submit" value="Unblock election results">
                </div>
            </form>
        {% endif %}

        <div id="logo">
            <img width=500 height=50 src="{% static 'passcode/assets/svg/org-logos.svg' %}">
        </div>
    </div> -->

    <div id="Audit" class="tab-content" style="{% if not open_audit %}display: none{% endif %}">
        {% if audits %}
            <div id="table-container">
                <div class="table-row row-0">
                    <div class="col-ID">ID Number</div>
                    <div class="col-TS">Timestamp</div>
                </div>

                <!-- TEMPLATES FOR DATA INSERTION. NOTE THAT THERE IS A "row-1" AND "row-2"  FOR THEIR ALTERNATING COLORS -->
                {% for audit in audits %}
                    <div class="table-row {% cycle 'row-1' 'row-2' %}">
                        <div class="col-ID">{{ audit.0 }}</div>
                        <div class="col-TS">{{ audit.1 }}</div>
                    </div>
                {% endfor %}

                <div class="pagination">
                    <span class="step-links">
                        {% if audits.has_previous %}
                        <a href="?page=1&audit=1{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}">&laquo;
                            first</a>
                        <a
                            href="?page={{ audits.previous_page_number }}&audit=1{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}">previous</a>
                        {% endif %}
                        <span class="current">Page {{ audits.number }} of {{ audits.paginator.num_pages }}.</span>
    
                        {% if audits.has_next %}
                        <a
                            href="?page={{ audits.next_page_number }}&audit=1{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}">next</a>
                        <a
                            href="?page={{ audits.paginator.num_pages }}&audit=1{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}">last
                            &raquo;</a>
                        {% endif %}
                    </span>
                </div>
            </div>
            {% else %}
                <header>Oops!</header>
                <div class="prohibited">
                    No one has voted yet.
                </div>
            {% endif %}

            <div id="logo">
                <img width=500 height=50 src="{% static 'officer/assets/svg/org-logos.svg' %}">
            </div>
        </div>
    </div>
</div>


</body>

<!-- JAVASCRIPT LINK-->
<script src="{% static 'officer/js/officer-results.js' %}"></script>
</html>


